if("/auth/login"===window.location.pathname||"/auth/login/"===window.location.pathname){const a=document.getElementById("loginForm"),b=document.querySelector("#matric"),c=document.querySelector("#password"),d=document.querySelector(".matric-number-error-message"),f=document.querySelector(".password-error-message"),g=document.querySelector(".btn-submit");b.addEventListener("keypress",a=>{8<b.value.length&&(a.preventDefault(),c.focus())}),g.addEventListener("click",a=>{b.value.length?9>b.value.length?(d.innerText="matric number must not be less than 9 characters",d.classList.add("error-message"),a.preventDefault()):d.innerText="":(d.innerText="matric number is required",d.classList.add("error-message"),a.preventDefault()),c.value.length?f.innerText="":(f.innerText="password is required",f.classList.add("error-message"),a.preventDefault())}),a.onsubmit=a=>{a.preventDefault(),$.ajax({url:"/auth/login",method:"POST",data:{username:b.value,password:c.value,claim:"user"},success:a=>"failed"===a.status&&"User has voted already"===a.error.message?Swal.fire({icon:"error",title:a.status.toLocaleUpperCase(),text:"Sorry you cannot vote twice"}):"failed"===a.status?Swal.fire({icon:"error",title:a.status,text:a.info.message}):"success"===a.status?Swal.fire({icon:"success",title:a.status,text:a.info.message}).then(c=>{(c.isConfirmed||c.isDismissed)&&(a.isFirstLogin?async function(){return Swal.fire({title:"Change Password",html:"<input type=\"password\" autocomplete=\"off\" id=\"swal-input1\" placeholder=\"Old Password\" class=\"swal2-input\"><input type=\"password\" autocomplete=\"off\" id=\"swal-input2\" placeholder=\"New Password\" class=\"swal2-input\"><input type=\"password\" autocomplete=\"off\" id=\"swal-input3\" placeholder=\"Confirm new Password\" class=\"swal2-input\"><br><small><b>Password must incluse at least one capital letter, number and special character eg $@,.</b></small>",focusConfirm:!1,preConfirm:()=>{const c=document.getElementById("swal-input1").value,d=document.getElementById("swal-input2").value,e=document.getElementById("swal-input3").value;return c.trim()===a.password?/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#\$%\^&\*])(?=.{8,})/g.test(d)?d.trim()===e.trim()?$.ajax({url:"/auth/change-pwd",method:"POST",data:{user:b.value,password:e},success:a=>{"success"===a.status&&Swal.fire({icon:"success",title:"Success",text:"Password reset successful"}).then(a=>{(a.isConfirmed||a.isDismissed)&&(window.location.href="/vote")})},error:a=>{"failed"===a.status&&Swal.fire({icon:"failed",title:"Error",text:a.message})}}):Swal.showValidationMessage("Passwords do not match"):Swal.showValidationMessage("Password criteria not met"):Swal.showValidationMessage("Incorrect previous password")}})}():window.location.href="/vote")}):void 0,error:a=>{(400===a.status||401===a.status)&&(Swal.fire({icon:"error",title:"Failed",text:"Incorrect username or password"}),c.value=null)}})}}if("/vote"===window.location.pathname||"/vote/"===window.location.pathname){const a=document.getElementsByClassName("accordion__item"),b=[],c=[],d=$("#voteForm");d.parsley();const e=document.getElementsByClassName("vote-btn");for(let a of e)a.addEventListener("click",d=>{d.preventDefault();const e=b.find(b=>b.post===a.id),f=c.find(b=>b.candidatePosition===a.id);if(!(e||f))toastr.info(`You voted ${a.name} as ${a.id}`),b.push({name:a.name,id:a.value,post:a.id}),c.push({candidateName:a.name,candidatePosition:a.id});else if(e.id===a.value&&f.candidateName===a.name)Swal.fire({icon:"info",text:"You already voted this person"}),toastr.error("You cannot vote the same candidate twice");else{const d=b.indexOf(e),g=c.indexOf(f);-1<d&&b.splice(d,1),-1<g&&c.splice(g,1),b.push({name:a.name,id:a.value,post:a.id}),toastr.info(`You voted ${a.name} as ${a.id}`),c.push({candidateName:a.name,candidatePosition:a.id})}});d.on("submit",d=>{let e=document.createElement("div");c.forEach(a=>{const b=document.createElement("p");b.innerText=`You voted ${a.candidateName} as ${a.candidatePosition}`,e.appendChild(b)}),d.preventDefault(),b.length==a.length?Swal.fire({icon:"info",title:"Summary",html:e,showCancelButton:!0}).then(a=>{a.isConfirmed&&$.ajax({url:"/vote",method:"POST",data:{candidates:b},success:b=>{"session-timeout"===b.status&&Swal.fire({icon:"error",title:"Session Expired",text:b.message}).then(b=>{(b.isConfirmed||a.isDismissed)&&(window.location.href="/auth/login")}),"success"===b.status?Swal.fire({icon:"success",title:"Vote Successful",text:"Your vote has been uploaded successfully"}).then(a=>{(a.isConfirmed||a.isDismissed)&&$.ajax({url:"/auth/logout",method:"GET",success:a=>{"logged out"===a.status&&(window.location.href="/auth/login")}})}):Swal.fire({icon:"error",title:"Error",text:b.message}).then(a=>{(a.isConfirmed||a.isDismissed)&&(window.location.href="/auth/login")})},error:a=>{Swal.fire({icon:"error",title:"Error",text:a.message})}})}):Swal.fire({icon:"error",text:"All candidates must be voted for"})})}if("/auth/login/admin"===window.location.pathname||"/auth/login/admin/"===window.location.pathname){const a=$("#email"),b=$("#password"),c=$("#loginForm");c.parsley(),c.on("submit",c=>{c.preventDefault(),$.ajax({url:"/auth/login",method:"POST",data:{username:a.val().trim(),password:b.val().trim(),claim:"admin"},success:a=>"failed"===a.status?Swal.fire({icon:"error",title:a.status,text:a.info?a.info.message:a.error.message}):"success"===a.status?Swal.fire({icon:a.status,title:a.status,text:a.info.message}).then(a=>{(a.isConfirmed||a.isDismissed)&&(window.location.href="/admin")}):void 0,error:a=>{(400===a.status||401===a.status)&&(Swal.fire({icon:"error",title:"Failed",text:"Incorrect username or password"}),b.val(null))}})})}if("/admin/create-position"===window.location.pathname||"/admin/create-position/"===window.location.pathname){const a=$("#position"),b=$("#position-desc"),c=$("#createForm");c.parsley(),c.on("submit",c=>{c.preventDefault(),$.ajax({url:"/admin/create-position",method:"POST",data:{position:a.val().trim(),position_desc:b.val().trim()},success:c=>{"success"===c.status&&(a.val(null),b.val(null),Swal.fire({icon:c.status,title:c.status.toLocaleUpperCase(),text:c.message})),"failed"===c.status&&Swal.fire({icon:"error",title:c.status.toLocaleUpperCase(),text:c.message})},error:a=>{Swal.fire({icon:"error",title:a.responseJSON.status.toLocaleUpperCase(),text:a.responseJSON.message})}})})}if("/admin/register-candidate"===window.location.pathname||"/admin/register-candidate/"===window.location.pathname){const a=$("#matNo"),b=$("#registerForm");b.parsley();let c="";const d=document.getElementById("uploadImgBtn");d.onclick=()=>{const a=new FormData;Swal.fire({title:"Upload Image",input:"file",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"Upload",showLoaderOnConfirm:!0,preConfirm:b=>{try{return a.append("image",b),axios.post("/admin/upload-image",a).then(a=>"failed"===a.data.status?Swal.fire({icon:"error",title:a.data.status.toLocaleUpperCase(),text:a.data.message}):(c=a.data,a)).catch(a=>{Swal.showValidationMessage(`Request failed: ${a}`)})}catch(a){return Swal.fire({icon:"error",title:"Failed",text:"Check your internet connection and refresh"})}},allowOutsideClick:()=>!Swal.isLoading()}).then(a=>{if(a.isConfirmed){return Swal.fire({icon:"success",title:"Success",text:"Image uploaded successfully!"})}})},b.on("submit",b=>{b.preventDefault(),$.ajax({url:"/admin/register-candidate",method:"POST",data:{matNo:a.val().trim(),image:c},success:b=>{"success"===b.status&&(a.val(null),Swal.fire({icon:b.status,title:b.status.toLocaleUpperCase(),text:b.message})),"failed"===b.status&&Swal.fire({icon:"error",title:b.status.toLocaleUpperCase(),text:b.message})},error:a=>{Swal.fire({icon:"error",title:a.responseJSON.status.toLocaleUpperCase(),text:a.responseJSON.message})}})})}if("/admin/map-candidates"===window.location.pathname||"/admin/map-candidates/"===window.location.pathname){const a=$("#candidate"),b=$("#position"),c=$("#registerForm");c.parsley(),c.on("submit",c=>{c.preventDefault(),$.ajax({url:"/admin/map-candidates",method:"POST",data:{candidateId:a.val().trim(),positionId:b.val().trim()},success:a=>{"success"===a.status&&Swal.fire({icon:a.status,title:a.status.toLocaleUpperCase(),text:a.message}),"failed"===a.status&&Swal.fire({icon:"error",title:a.status.toLocaleUpperCase(),text:a.message})},error:a=>{Swal.fire({icon:"error",title:a.responseJSON.status.toLocaleUpperCase(),text:a.responseJSON.message})}})})}if(window.location.pathname.includes("/admin")){const a=document.getElementById("changePwdBtn");a.onclick=a=>{a.preventDefault(),async function(){const a=await axios.get("/admin/change-pwd");return"success"===a.data.status?Swal.fire({title:"Change Password",html:"<input type=\"password\" autocomplete=\"off\" id=\"swal-input1\" placeholder=\"Old Password\" class=\"swal2-input\"><input type=\"password\" autocomplete=\"off\" id=\"swal-input2\" placeholder=\"New Password\" class=\"swal2-input\"><input type=\"password\" autocomplete=\"off\" id=\"swal-input3\" placeholder=\"Confirm new Password\" class=\"swal2-input\"><br><small><b>Password must incluse at least one capital letter, number and special character eg $@,.</b></small>",focusConfirm:!1,preConfirm:()=>{const b=document.getElementById("swal-input1").value,c=document.getElementById("swal-input2").value,d=document.getElementById("swal-input3").value;return b.trim()===a.data.admin.password?/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#\$%\^&\*])(?=.{8,})/g.test(c)?c.trim()===d.trim()?$.ajax({url:"/admin/change-pwd",method:"POST",data:{user:a.data.admin._id,password:d},success:a=>{"success"===a.status&&Swal.fire({icon:"success",title:"Success",text:"Password reset successful"}),"failed"===a.status&&Swal.fire({icon:"error",title:"Failed",text:a.message})},error:a=>{"failed"===a.status&&Swal.fire({icon:"failed",title:"Error",text:a.message})}}):Swal.showValidationMessage("Passwords do not match"):Swal.showValidationMessage("Password criteria not met"):Swal.showValidationMessage("Incorrect previous password")}}):void Swal.fire({icon:"error",title:"Error",text:a.data.message})}()};const b=document.getElementById("logoutBtn");b.onclick=a=>{a.preventDefault(),Swal.fire({icon:"warning",title:"Confirm Logout",text:"Are you sure you want to logout?",confirmButtonText:"Yes",showCancelButton:!0,cancelButtonText:"No"}).then(async a=>{if(a.isConfirmed){const a=await axios.get("/admin/logout");"logged out"===a.data.status&&(window.location.href="/auth/login/admin")}})};const c=$("#pdf-btn"),d=$("#csv-btn"),f=$("#fileName");c.on("click",a=>{a.preventDefault(),$("#dataTable").tableHTMLExport({type:"pdf",filename:`${f.text()}.pdf`})}),d.on("click",a=>{a.preventDefault(),$("#dataTable").tableHTMLExport({type:"csv",filename:`${f.text()}.csv`,separator:",",newline:"\r\n",trimContent:!0,quoteFields:!0})})}if("/admin/generate-passwords"===window.location.pathname||"/admin/generate-passwords/"===window.location.href){const a=document.getElementById("generateBtn");a.onclick=async a=>{a.preventDefault();const b=await axios.get("/admin/generate-passwords/generate");"success"===b.data.status&&Swal.fire({icon:"success",title:"Success",text:b.data.message}).then(a=>{(a.isConfirmed||a.isDismissed)&&window.location.reload()})}}